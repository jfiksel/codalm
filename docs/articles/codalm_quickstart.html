<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use codalm â€¢ codalm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use codalm">
<meta property="og:description" content="codalm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">codalm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/codalm_quickstart.html">How to use codalm</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jfiksel/codalm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use codalm</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jfiksel/codalm/blob/master/vignettes/codalm_quickstart.Rmd"><code>vignettes/codalm_quickstart.Rmd</code></a></small>
      <div class="hidden name"><code>codalm_quickstart.Rmd</code></div>

    </div>

    
    
<p>We will start by loading the <code>codalm</code> R package, in addition to the <code>ggtern</code> package, which we will use to access the data.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">codalm</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggtern</span>)
<span class="co">#&gt; Loading required package: ggplot2</span>
<span class="co">#&gt; Registered S3 methods overwritten by 'ggtern':</span>
<span class="co">#&gt;   method           from   </span>
<span class="co">#&gt;   grid.draw.ggplot ggplot2</span>
<span class="co">#&gt;   plot.ggplot      ggplot2</span>
<span class="co">#&gt;   print.ggplot     ggplot2</span>
<span class="co">#&gt; --</span>
<span class="co">#&gt; Remember to cite, run citation(package = 'ggtern') for further info.</span>
<span class="co">#&gt; --</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ggtern'</span>
<span class="co">#&gt; The following objects are masked from 'package:ggplot2':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     aes, annotate, ggplot, ggplot_build, ggplot_gtable, ggplotGrob,</span>
<span class="co">#&gt;     ggsave, layer_data, theme_bw, theme_classic, theme_dark,</span>
<span class="co">#&gt;     theme_gray, theme_light, theme_linedraw, theme_minimal, theme_void</span></pre></body></html></div>
<p>We will now load in the data from the ggtern package. We will be analyzing how two different methods (image analysis or microscopic inspection) estimate the composition of 30 white blood cells. The format that we need is for both compositions to be in matrices, with one row per observation. We will also normalize the rows of these matrices to ensure that they sum to 1, although the <code>codalm</code> function would also take care of this for us.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"WhiteCells"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">'ggtern'</span>)
<span class="no">image</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">WhiteCells</span>, <span class="no">Experiment</span> <span class="kw">==</span> <span class="st">"ImageAnalysis"</span>)
<span class="no">image_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">image</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"G"</span>, <span class="st">"L"</span>, <span class="st">"M"</span>)])
<span class="no">microscopic</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">WhiteCells</span>, <span class="no">Experiment</span> <span class="kw">==</span> <span class="st">"MicroscopicInspection"</span>)
<span class="no">microscopic_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">microscopic</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"G"</span>, <span class="st">"L"</span>, <span class="st">"M"</span>)])

<span class="no">image_mat</span>  <span class="kw">&lt;-</span> <span class="no">image_mat</span>  / <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">image_mat</span>)
<span class="no">microscopic_mat</span> <span class="kw">&lt;-</span> <span class="no">microscopic_mat</span> / <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">microscopic_mat</span>)</pre></body></html></div>
<p>To estimate the coefficient matrix B, we can use the <code>codalm</code> function.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">B_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/codalm.html">codalm</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">microscopic_mat</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">image_mat</span>)
<span class="no">B_est</span>
<span class="co">#&gt;              [,1]       [,2]         [,3]</span>
<span class="co">#&gt; [1,] 9.742582e-01 0.02292755 2.814241e-03</span>
<span class="co">#&gt; [2,] 3.267605e-09 1.00000000 3.620972e-10</span>
<span class="co">#&gt; [3,] 9.484137e-18 0.04198815 9.580118e-01</span></pre></body></html></div>
<p>To see the interpretation of this matrix, please see <a href="https://arxiv.org/abs/2004.07881">Fiksel et al. (2020)</a>. If all the rows of B_est are exactly the same, it is recommended to set <code>accelerate = FALSE</code> as a sensitivity check.</p>
<p>We can also use the bootstrap to estimate 95% confidence intervals. We will only use 50 bootstrap iterations as an example (nboot = 50), but is recommended to do more.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">B_ci</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/codalm_ci.html">codalm_ci</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">microscopic_mat</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">image_mat</span>, <span class="kw">nboot</span> <span class="kw">=</span> <span class="fl">50</span>,
                   <span class="kw">conf</span> <span class="kw">=</span> <span class="fl">.95</span>)
<span class="no">B_ci</span>$<span class="no">ci_L</span>
<span class="co">#&gt;              [,1]       [,2]         [,3]</span>
<span class="co">#&gt; [1,] 9.576089e-01 0.01399186 1.156448e-03</span>
<span class="co">#&gt; [2,] 2.512029e-15 0.97220006 9.764192e-17</span>
<span class="co">#&gt; [3,] 6.197244e-21 0.01165546 9.145955e-01</span>
<span class="no">B_ci</span>$<span class="no">ci_U</span>
<span class="co">#&gt;              [,1]       [,2]         [,3]</span>
<span class="co">#&gt; [1,] 9.837854e-01 0.03981767 4.560504e-03</span>
<span class="co">#&gt; [2,] 2.779953e-02 1.00000000 4.198096e-07</span>
<span class="co">#&gt; [3,] 3.143104e-06 0.08540455 9.868145e-01</span></pre></body></html></div>
<p>These matrices given the lower and upper bounds for the confidence interval for each element of the coefficient matrix.</p>
<p>You can also take advantage of parallelization, if you have multiple cores available.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">ncores</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fl">1</span>, <span class="kw pkg">parallel</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span>() - <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span>(<span class="kw">R_FUTURE_SUPPORTSMULTICORE_UNSTABLE</span> <span class="kw">=</span> <span class="st">"quiet"</span>)
<span class="no">B_ci_parallel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/codalm_ci.html">codalm_ci</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">microscopic_mat</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">image_mat</span>, <span class="kw">nboot</span> <span class="kw">=</span> <span class="fl">50</span>,
                   <span class="kw">conf</span> <span class="kw">=</span> <span class="fl">.95</span>, <span class="kw">parallel</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">ncpus</span> <span class="kw">=</span> <span class="no">ncores</span>)
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">B_ci</span>$<span class="no">ci_L</span>, <span class="no">B_ci_parallel</span>$<span class="no">ci_L</span>)
<span class="co">#&gt; [1] TRUE</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">B_ci</span>$<span class="no">ci_U</span>, <span class="no">B_ci_parallel</span>$<span class="no">ci_U</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
<p>Finally, we will do a permutation test for linear independence. Again, we will only do 50 permutations as an example, but in practice this number should be higher. For demonstration purposes, we will generate the compositional outcome independently of the compositional predictor</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">123</span>)
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="kw pkg">gtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gtools/man/dirichlet.html">rdirichlet</a></span>(<span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fl">3</span>))
<span class="no">y</span> <span class="kw">&lt;-</span> <span class="kw pkg">gtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gtools/man/dirichlet.html">rdirichlet</a></span>(<span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fl">3</span>))
<span class="no">indep_test_pval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/codalm_indep_test.html">codalm_indep_test</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>,
                                     <span class="kw">nperms</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">init.seed</span> <span class="kw">=</span> <span class="fl">123</span>)
<span class="no">indep_test_pval</span>
<span class="co">#&gt; [1] 0.28</span></pre></body></html></div>
<p>This function can also be parallelized. Unlike the bootstrapping, there is no need to differentiate between whether the user is using a Windows or Unix system.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">indep_test_pval_parallel</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/codalm_indep_test.html">codalm_indep_test</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>,
                                     <span class="kw">nperms</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">init.seed</span> <span class="kw">=</span> <span class="fl">123</span>,
                                     <span class="kw">parallel</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">ncpus</span> <span class="kw">=</span> <span class="no">ncores</span>)
<span class="no">indep_test_pval_parallel</span>
<span class="co">#&gt; [1] 0.28</span></pre></body></html></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jacob Fiksel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
